# Google Calendar Sync (Interview Task)

## Задача
Сделать одностороннюю синхронизацию Google календарей с расписанием мероприятий в зале, т.е из Google календарей в базу
данных

## 1. Запуск

1. Создаем google приложение с доступом к google календарю https://console.cloud.google.com/apis/dashboard
2. Создаем OAuth 2.0 Client Web client https://console.cloud.google.com/apis/credentials
3. Скачиваем json client file и размещаем его в google_apps/credentials/secret.json
4. Добавляем в Authorized redirect URIs - http://127.0.0.1/callback/oauth2/calendar
5. Добавляем свой емайл в список тестовых пользователей  - https://console.cloud.google.com/apis/credentials/consent
6. Переходим в папку с проектом, копируем env:
```sh
cd google_calendar_sync
cp ./.env.example ./.env
```
7. Устанавливаем и настраиваем docker и docker-compose (при необходимости);
8. Запускаем проект:
```sh
docker-compose up -d
```
9. Создаем суперпользователя:
```sh
docker exec -it google_calendar_sync-web bash
source ./venv/bin/activate
python ./manage.py createsuperuser
```
10. Заходим на сайт, по умолчанию - http://127.0.0.1

## 2. Автоматические тесты
Запускаем проект см. пункт 1
```
docker exec -it google_calendar_sync-web bash
sh ./scripts/run_tests.sh
```

## 3. Описание
Приложение синхронизирует события из гугл календаря в базу данных, при этом проверяет пересечения дат. Для синхранизации календарей используется google Oauth2. Создание учетных данных происходит в Вэб интерфейсе и сохраняется в базу данных, обновляя токен автоматически при истечении времени жизни. Синхранизировать можно только календари, доступные google пользователю. Синхранизация происходит автоматически через настраиваемые промежутки времени.

## 4. Функции
1. Создание компаний;
2. Синхронизация календарей;
3. Включение/Отключение календарей для определенных компаний (один календарь не может быть включен в нескольких компаниях);
4. Определение пересечения дат;
5. Логирование в файл и базу данных

Для добавления общедоступного календаря, добавьете его себе а аккаунт, после он будет доступен в приложении.

## 5. Основные настройки
```python
# Количество компаний, которым разрешено обновляться одновременно
MAX_PARALEL_COMPANY_SYNK=1
# Если равно - 1, то обновление календаря будет происходить синхронно сразу после включения (не рекомендуется для больших календарей)
SYNC_AFTER_CREATE=0
# Таймаут синхранизации в секундах
SYNC_TIMEOUT=120
# Промежуток времени между синхранизацией с секундах
UPDATE_FREQUENCY=120
```
